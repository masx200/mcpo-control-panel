[English](README.md) | [Русский](README_RU.md)

# MCPO Control Panel (Панель управления MCPO)

[![Python Version](https://img.shields.io/pypi/pyversions/mcpo-control-panel.svg)](https://pypi.org/project/mcpo-control-panel/)
[![PyPI version](https://badge.fury.io/py/mcpo-control-panel.svg)](https://badge.fury.io/py/mcpo-control-panel)

Веб-панель управления, предназначенная для упрощения управления экземплярами [MCP-to-OpenAPI (`mcpo`)](https://github.com/open-webui/mcpo) и их серверными конфигурациями. Она предоставляет удобный пользовательский интерфейс и API для взаимодействия с `mcpo`.

## Демо

https://github.com/user-attachments/assets/dc3f11de-82f6-42ee-a72f-7181c9af0f45

![image](https://github.com/user-attachments/assets/64ad95ad-4ea8-44d8-a935-bac98b866760)

![image](https://github.com/user-attachments/assets/49c22169-09b1-440b-a662-41b3f7f11ae9)

![image](https://github.com/user-attachments/assets/6ee9aed8-ea60-48fa-adb6-e93066120bd7)

![image](https://github.com/user-attachments/assets/9c82d141-e8cd-4dc5-890e-d271ddb94b77)


## Ключевые особенности

*   **Управление определениями серверов:**
    *   Создание, чтение, обновление и удаление определений серверов (для типов `stdio`, `sse`, `streamable_http`).
    *   Легкое включение/отключение серверов для конфигурации `mcpo`.
    *   Интуитивно понятные формы для указания команд, аргументов, переменных окружения и URL-адресов.
*   **Массовые операции с серверами:**
    *   Добавление нескольких определений серверов одновременно путем вставки JSON-содержимого.
    *   Поддержка различных форматов JSON (объект с `mcpServers`, прямое сопоставление имени с конфигурацией, список объектов серверов).
    *   Двухэтапный процесс массового добавления:
        1.  **Анализ:** Предварительный просмотр новых допустимых серверов, существующих и недопустимых записей из вашего JSON.
        2.  **Подтверждение:** Добавление в базу данных только проверенных новых серверов.
    *   Автоматическая деадаптация команд, специфичных для Windows (например, `cmd /c npx ...` -> `npx ...`).
*   **Управление процессом MCPO:**
    *   Запуск, остановка и перезапуск процесса `mcpo` непосредственно из пользовательского интерфейса.
    *   Просмотр статуса процесса `mcpo` в реальном времени (Работает, Остановлен, Ошибка).
    *   Функциональность "Применить и перезапустить": генерирует конфигурацию `mcpo` из текущих определений серверов, а затем перезапускает `mcpo`.
*   **Просмотр логов:**
    *   Отображение последних логов из файла логов процесса `mcpo`.
    *   Настраиваемое автообновление логов.
    *   Опции ручного обновления и автопрокрутки.
*   **Конфигурация настроек MCPO:**
    *   Управление параметрами запуска `mcpo` (порт, использование API-ключа, путь к файлу конфигурации, путь к файлу логов).
    *   Настройка поведения пользовательского интерфейса (интервал обновления логов).
    *   Настройка и управление параметрами проверки работоспособности для `mcpo`.
*   **Агрегация и просмотр инструментов:**
    *   Динамически извлекает и отображает список доступных инструментов (пути к серверам и сводки) из работающего экземпляра `mcpo` путем запроса его спецификаций OpenAPI.
    *   Предоставляет базовый URL для создания ссылок вызова инструментов.
*   **Проверки работоспособности и автоперезапуск:**
    *   Фоновый мониторинг работоспособности процесса `mcpo` с использованием встроенного эхо-сервера.
    *   Настраиваемый интервал проверки, количество неудачных попыток и задержки повторных попыток.
    *   Опциональный автоматический перезапуск `mcpo` в случае последовательных сбоев проверки работоспособности.
*   **Динамическая генерация конфигурации:**
    *   Генерирует файл `mcp_generated_config.json` для `mcpo` на основе включенных определений серверов.
    *   Предоставляет опции для загрузки стандартной конфигурации или адаптированной для Windows версии (которая оборачивает команды, такие как `npx`, `uvx`, `docker`, в `cmd /c ...`).
*   **Современный веб-интерфейс:**
    *   Создан с использованием FastAPI, шаблонов Jinja2 и HTMX для отзывчивого и динамичного пользовательского опыта.
    *   Использует Materialize CSS для стилизации.
    *   Постоянное хранилище с использованием базы данных SQLite (через SQLModel).

## Установка

Рекомендуется использовать `uv` для установки, если он доступен, так как это обычно быстрее.

### Способ 1: Использование uv (Рекомендуется)

```bash
uv pip install mcpo-control-panel
```

### Способ 2: Использование pip (Традиционный)

#### Предварительные требования

*   Python 3.11 или выше.

```bash
pip install mcpo-control-panel
```

### Способ 3: Из исходного кода (для разработки)

1.  Клонируйте репозиторий:
    ```bash
    git clone https://github.com/daswer123/mcpo-control-panel.git
    cd mcpo-control-panel
    ```
2.  Установите в редактируемом режиме (это также установит зависимости):
    ```bash
    pip install -e .
    ```
    
    ### Способ 4: Использование Docker
    
    Вы также можете запустить MCPO Control Panel с помощью Docker. Это удобный способ запуска приложения в изолированной среде.
    
    1.  **Загрузите готовый образ из Docker Hub:**
        ```bash
        docker pull daswer123/mcpo-control-panel:latest
        ```
    
    2.  **Или соберите Docker-образ самостоятельно:**
        Убедитесь, что в корне вашего проекта есть файлы [`Dockerfile`](Dockerfile:1) и [`docker-compose.yml`](docker-compose.yml:1).
        ```bash
        docker compose build
        ```
    
    3.  **Запустите приложение с помощью Docker Compose:**
        ```bash
        docker compose up
        ```
        Это запустит MCPO Control Panel, и она будет доступна по адресу `http://localhost:8083/ui` по умолчанию. Данные будут сохраняться в томе `./data` на вашем хост-компьютере.
    
        При необходимости вы можете настроить порт и каталог данных в файле [`docker-compose.yml`](docker-compose.yml:1). Переменные окружения, такие как `MCPO_MANAGER_HOST`, `MCPO_MANAGER_PORT` и `MCPO_MANAGER_DATA_DIR`, также учитываются Docker-контейнером.

## Запуск приложения

После установки вы можете запустить MCPO Control Panel.

**Использование `python -m` (работает с установками через `pip` или `uv`):**

```bash
python -m mcpo_control_panel [OPTIONS]
```

**Использование установленного скрипта (если каталог скриптов вашего Python окружения находится в PATH):**

```bash
mcpo-control-panel [OPTIONS]
```

**Общие опции:**

*   `--host TEXT`: Хост для привязки сервера. (По умолчанию: `127.0.0.1`)
    *   Переменная окружения: `MCPO_MANAGER_HOST`
*   `--port INTEGER`: Порт для привязки сервера. (По умолчанию: `8083`)
    *   Переменная окружения: `MCPO_MANAGER_PORT`
*   `--workers INTEGER`: Количество рабочих процессов Uvicorn. (По умолчанию: `1`)
    *   Переменная окружения: `MCPO_MANAGER_WORKERS`
*   `--reload`: Включить автоматическую перезагрузку (для разработки).
*   `--config-dir TEXT`: Каталог для хранения данных MCPO manager (база данных SQLite, PID-файлы, сгенерированные конфигурации, настройки).
    *   По умолчанию: `~/.mcpo_manager_data` (например, `C:\Users\YourUser\.mcpo_manager_data` в Windows или `/home/youruser/.mcpo_manager_data` в Linux).
    *   Переменная окружения: `MCPO_MANAGER_DATA_DIR`

**Пример:**

```bash
python -m mcpo_control_panel --port 8083 --reload --config-dir "/path/to/my/mcpo-data"
```

**Пример использования `uvx` (выполняет команду в изолированном окружении с указанным пакетом):**

Это особенно полезно для быстрых запусков или тестирования без изменения вашего глобального/текущего окружения.

```bash
uvx --with mcpo-control-panel python -m mcpo_control_panel --host 0.0.0.0 --port 8934 --config-dir test
```

Или используя переменные окружения:

```bash
export MCPO_MANAGER_PORT=8083
export MCPO_MANAGER_DATA_DIR="/path/to/my/mcpo-data"
python -m mcpo_control_panel --reload
```

Приложение создаст указанный `--config-dir`, если он не существует. Все данные приложения, включая базу данных SQLite (`mcp_manager_data.db`), файл настроек (`mcpo_manager_settings.json`), сгенерированную конфигурацию MCPO (`mcp_generated_config.json`) и PID-файл процесса `mcpo`, будут храниться в этом каталоге.

### Доступ к пользовательскому интерфейсу

После запуска сервера откройте веб-браузер и перейдите по адресу:

`http://<host>:<port>/ui`

Например, при запуске с настройками по умолчанию: `http://127.0.0.1:8083/ui`

## Конфигурация

Большинство конфигураций для самого процесса `mcpo` (например, его порт, использует ли он API-ключ, пути к файлам логов) и для пользовательского интерфейса (например, настройки автообновления логов, параметры проверки работоспособности) управляются через веб-интерфейс на странице "MCPO Settings".

Эти настройки сохраняются в `mcpo_manager_settings.json` в каталоге `MCPO_MANAGER_DATA_DIR_EFFECTIVE` (каталог, указанный параметром `--config-dir` или его значение по умолчанию).

## Лицензия

Этот проект лицензирован под лицензией MIT.